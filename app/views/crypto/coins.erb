  <%= ul_nav (
      [['holding', '/coins/tag/holding']] +
      [['gainers', '/coins/tag/gainers']] +
      (tags = Tag.where(:id.in => Coin.pluck(:tag_id)).sort_by { |tag| -tag.holding }).map { |tag| [tag_badge(tag), "/coins/tag/#{tag.name}"] }
    ),
    ul_class: 'nav nav-tabs',
    li_class: 'nav-item',
    li_active_class: nil,
    a_class: 'nav-link',
    a_active_class: 'active',
    ul_id: nil,
    generate_subnav_href_and_ul: false
%>

<div class="mt-3">
  <% total_holding = Tag.holding %>
  <% tags.each { |tag| %>
  <% if tag.holding > 0 %>
    <% relative_holding = tag.holding / total_holding %>
    <a href="/coins/tag/<%=tag.name%>" data-toggle="tooltip" title="<%=tag.name%>" class="text-center d-inline-block p-1" style="color: <%=tag.color || 'white'%>; background-color: <%=tag.background_color || '#6C757D'%>; width: <%=(relative_holding*100).floor%>%">
      <%= number_to_percentage relative_holding*100, precision: 1 %>
    </a>
  <% end %>
  <% } %>
</div>

<% case params[:tag]; when nil, 'holding' %>

<%= partial :'crypto/coin_table', locals: {coins: Coin.where(
      :starred => true
    ).order('price_change_percentage_7d_in_currency desc')} %>

<% when 'gainers' %>

<%= partial :'crypto/coin_table', locals: {coins: Coin.where(
      :hidden.ne => true,
      :market_cap_rank.ne => nil,
      :market_cap.gte => 1_000_000,
      :total_volume.gte => 1_000_000
    ).order('price_change_percentage_7d_in_currency desc').limit(20)} %>

<% else %>

  <div data-pagelet-url="/coins/table/<%=params[:tag]%>?add=true"></div>

<% end %>
